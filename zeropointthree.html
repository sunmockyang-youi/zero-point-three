<!DOCTYPE html>
<meta charset="utf-8" />
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=0.65">
	<title>0.3%</title>
	<link rel="stylesheet" type="text/css" href="stylesheet.css">

	<script type="text/javascript">

	function LoadFile(path, mimeType, callback) {
		var xobj = new XMLHttpRequest();
		if (mimeType) {xobj.overrideMimeType(mimeType);}
		xobj.open('GET', path, true);
		xobj.onreadystatechange = function () {
			if (xobj.readyState == 4 && xobj.status == "200") {
				callback(xobj.responseText);
			}
		};
		xobj.send(null);  
	};

	// Load configuration file
	var dataSrc = "content/zero_point_three_config.json";
	var config = null;
	LoadFile(dataSrc, "application/json", function(text) {config = JSON.parse(text); onLoad();});

	// Load sections
	var sectionPaths = ["01-Prologue.html",
						"02-Manel.html",
						"03-Mohammed-Ali.html",
						"04-Safa.html",
						"05-Lilli.html",
						"06-UndergroundChurch.html",
						"07-ChurchOfTunisia.html",
						"08-TunisianSociety.html",
						"09-Conclusion.html"];
	var sectionsLoaded = false;
	var loadedSections = {};

	function onSectionLoad(path, html) {
		loadedSections[path] = html;

		for (var i in loadedSections) {
			if (!loadedSections[i]) return;
		}

		// All the sections have been loaded. proceed with rendering
		sectionsLoaded = true;
		onLoad();
	};

	for (var i = 0; i < sectionPaths.length; i++) {
		loadedSections[sectionPaths[i]] = null;

		LoadFile("content/sections/" + sectionPaths[i], null, onSectionLoad.bind(window, sectionPaths[i]));
	};
	</script>
</head>
<body>
<!-- Background media -->
<div class="background-media-container">
<!--  -->
	<div class="intro-video-container hidden">
		<video class="fullscreen video" id="video1" data-aspect-ratio="1.7778" data-scale="1.1" loop muted="true">
			<source src="https://s3.amazonaws.com/sunnymock/zeropointthree/content/ZeroPointThree_Islam.mp4" type="video/mp4">
		</video>
		<video class="fullscreen video" id="video2" data-aspect-ratio="1.7778" loop muted="true">
			<source src="https://s3.amazonaws.com/sunnymock/zeropointthree/content/ZeroPointThree_Christian.mp4" type="video/mp4">
		</video>
		<!-- add a down arrow here. Look up middle eastern street sign -->
	</div>

	<div id="index-background" class="index-background-container hidden">
		<div class="index-background-image show" id="dali_bg"></div>
		<div class="index-background-image" id="manel_bg"></div>
		<div class="index-background-image" id="mohammed_ali_bg"></div>
		<div class="index-background-image" id="safa_bg"></div>
		<div class="index-background-image" id="lilli_bg"></div>
		<div class="index-background-image" id="underground_church_bg"></div>
		<div class="index-background-image" id="church_of_tunisia_bg"></div>
		<div class="index-background-image" id="tunisian_society_bg"></div>
		<div class="index-background-image" id="conclusion_bg"></div>
	</div>
</div>

<!-- Title -->
<div class="intro-title-container">
	<div id="title1" class="intro-title">
		<span id="title1_text">Underground.</span>
	</div>
	<div id="title2" class="intro-title">
		<span id="title2_text">Divergent, Underground and Undetected: The Plight of a religious minority living in a Muslim world</span>
	</div>
</div>

<div id="intro-buffer"></div>
<!-- Article -->

<div id="articleContainer" class="article-container">
	<div id="intro-paragraph">
		<p>Divergent. </p>
		<p>Underground.</p>
		<p>Undetected. </p>
		<p>They chose a life that deviates from the norm. </p>
		<p>Some chose a life of hiding; some chose to expose themselves. Many of them don&#39;t even know if others like them exist. </p>
		<p>What is life like for this almost invisible group in the periphery of Muslim society?  </p>
		<p>This multimedia investigation takes a rare glance into the lives of Tunisian Christians, living as the 0.3 per cent among the 99.</p>
	</div>

	<div class="index-wrapper">
		<div class="index-box">

			<div class="index-title">Table of Contents</div>
			<hr class="index-hr" />

			<div class="index-header">Part 1: Stories</div>

			<div class="index-item">
				<div class="item-link" data-link-id="dali_bg">Dali</div>
			</div>
			<div class="index-item">
				<div class="item-link" data-link-id="manel_bg">Manel</div>
			</div>
			<div class="index-item">
				<div class="item-link" data-link-id="mohammed_ali_bg">Mohammed Ali</div>
			</div>
			<div class="index-item">
				<div class="item-link" data-link-id="safa_bg">Safa</div>
			</div>
			<div class="index-item">
				<div class="item-link" data-link-id="lilli_bg">Lilli</div>
			</div>

			<hr class="index-hr" />
			<div class="index-header">Part 2: Stories</div>

			<div class="index-item">
				<div class="item-link" data-link-id="underground_church_bg">The Underground Church</div>
			</div>
			<div class="index-item">
				<div class="item-link" data-link-id="church_of_tunisia_bg">The Church of Tunisia &amp; Islam's Response</div>
			</div>
			<div class="index-item">
				<div class="item-link" data-link-id="tunisian_society_bg">The Tunisian Society</div>
			</div>
			<hr class="index-hr" />
			<div class="index-item">
				<div class="item-link" data-link-id="conclusion_bg">Conclusion</div>
			</div>
		</div>
	</div>
</div>

<!-- Footer -->

<script type="text/javascript">
// Global vars
var app = null;
var elements = null;

function main() {
	injectSections();

	elements = {
		background: {
			scrollBuffer: document.getElementById('intro-buffer'),
			videoContainer: document.getElementsByClassName('intro-video-container')[0],
			video1: document.getElementById('video1'),
			video2: document.getElementById('video2'),
			title1: document.getElementById('title1'),
			title2: document.getElementById('title2'),
			titleContainer: document.getElementsByClassName("intro-title-container")[0],
			indexBackground: document.getElementById('index-background')
		},

		index: {
			indexButtons: document.getElementsByClassName('item-link'),
			backgroundImages: document.getElementsByClassName('index-background-image'),
			indexWrapper: document.getElementsByClassName("index-wrapper")[0],
			indexBox: document.getElementsByClassName("index-box")[0],
			indexBackground: document.getElementById('index-background')
		},

		article: {
			introParagraph: document.getElementById("intro-paragraph"),
			container: document.getElementsByClassName("article-container")[0]
		},

		fullscreenElements: document.getElementsByClassName('fullscreen')
	};

	app = new ZeroPointThree(config, elements);
}

function injectSections() {
	var sectionsRawText = "";
	for (var i = 0; i < sectionPaths.length; i++) {
		sectionsRawText += loadedSections[sectionPaths[i]];
	};
	document.getElementById('articleContainer').innerHTML += sectionsRawText;

	// Clear up some memory
	loadedSections = null;
}

function onResize() {
	app.onResize();
}

function onLoad() {
	console.log(document.readyState === "complete",
		config != null,
		sectionsLoaded == true);

	if (document.readyState === "complete" &&
		config != null &&
		sectionsLoaded) {
		main();
	}
}

window.onload = onLoad;
window.onresize = onResize;
</script>

<script type="text/javascript" src="js/ZeroPointThree.js"></script>
<script type="text/javascript" src="js/BackgroundMedia.js"></script>
<script type="text/javascript" src="js/IndexController.js"></script>
<script type="text/javascript" src="js/ScrollRange.js"></script>
<script type="text/javascript" src="js/Utils.js"></script>
</body>
</html>
